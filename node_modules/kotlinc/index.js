require('shelljs/global')
var path = require('path')

var UPPER = ['X', 'P']
var NO_VALUE = ['no-stdlib', 'source-map', 'meta-info', 'nowarn', 'verbose', 'version', 'help', 'h', 'X']

function compile (options, cb) {
    const command = [
        path.join(
            __dirname,
            'kotlinc',
            'bin',
            'kotlinc-js' + (process.platform === 'win32' ? '.bat' : '')
        )
    ]

    command.push(options.src)
    delete options.src

    Object.keys(options).forEach(function (key) {
        var key2 = UPPER.indexOf(key) === -1
            ? key.replace(/([A-Z])/g, '-$1').toLowerCase()
            : key
        var value = options[key]
        if (NO_VALUE.indexOf(key2) !== -1) {
            value = ''
        }
        command.push('-' + key2 + ' ' + value)
    })

    return exec(command.join(' '), cb)
}

module.exports = compile